{"version":3,"file":"uilVRMenuExample.js","sources":["../src/xr/UILVrMenu.js","../src/kit/uilVRMenuExample.js"],"sourcesContent":["import * as THREE from 'three';\r\nimport { VrMenu } from './VrMenu.js';\r\nimport { ControllersManager, EventTypes as CMEventTypes } from './ControllersManager.js';\r\nimport * as UIL from '../vendor/uil.custom.module.js';\r\nimport * as BufferGeometryUtils from 'three/addons/utils/BufferGeometryUtils.js';\r\n\r\nexport class UILVrMenu extends VrMenu {\r\n\tconstructor(worldContainer, controllersManager, options) {\r\n\t\tsuper(worldContainer, controllersManager, options);\r\n\r\n\t\tthis._vrUI = new UIL.Gui({\r\n\t\t\tw: 512,\r\n\t\t\tmaxHeight: 512,\r\n\t\t\tcolors: { bg: '#FFF' },\r\n\t\t\tisCanvas: true,\r\n\t\t\tparent: null,\r\n\t\t});\r\n\t}\r\n\r\n\tcreateMap() {\r\n\t\t//https://github.com/lo-th/uil\r\n\r\n\t\tconst me = this;\r\n\t\tthis._vrUI.onDraw = function () {\r\n\t\t\t// this.canvas es el canvas del objeto ui\r\n\r\n\t\t\tif (!me._map) {\r\n\t\t\t\t//let dom = this.ui.zone;\r\n\t\t\t\t//console.log(dom);\r\n\r\n\t\t\t\t//this.canvas.drawRect(0, 0, 10, 10);\r\n\t\t\t\tme._map = new THREE.Texture(this.canvas);\r\n\t\t\t\tme._map.wrapS = THREE.RepeatWrapping;\r\n\t\t\t\tme._map.wrapT = THREE.RepeatWrapping;\r\n\t\t\t\tme._map.minFilter = THREE.LinearFilter;\r\n\t\t\t\tme._map.needsUpdate = true;\r\n\r\n\t\t\t\t//if( useEncoding ) screen.encoding = THREE.sRGBEncoding\r\n\t\t\t\tme._frontMaterial.map = me._map;\r\n\t\t\t\tme._frontMaterial.needsUpdate = true;\r\n\t\t\t} else {\r\n\t\t\t\tme._map.needsUpdate = true;\r\n\t\t\t}\r\n\r\n\t\t\tconst uiHeightPx = me._vrUI.zone.h; // Is the height of the UI in pixels\r\n\t\t\tconst canvasHeightPx = me._vrUI.forceHeight; // Is the height of the canvas in pixels\r\n\t\t\tconst canvasWidthPx = me._vrUI.zone.w; // Is the width of the canvas in pixels\r\n\r\n\t\t\tme._updateAspectRatio(canvasWidthPx, canvasHeightPx, uiHeightPx);\r\n\r\n\t\t\t//console.log('ui.onDraw()');\r\n\t\t};\r\n\t}\r\n\r\n\t_onPointerEvent = (e) => {\r\n\t\t// e.type: pointerdown,pointerup,pointermove\r\n\t\t// e.data: x,y in [0,1] range\r\n\r\n\t\tswitch (e.type) {\r\n\t\t\tcase 'pointerdown':\r\n\t\t\t\t// Important!! After setMouse, we need to triggerMouseMove\r\n\t\t\t\t// We need to setMouse and triggerMouseMove before triggerMouseDown\r\n\t\t\t\t// to capture the latest pointer position\r\n\r\n\t\t\t\tthis._vrUI.setMouse(e.data);\r\n\t\t\t\tthis._vrUI.triggerMouseMove();\r\n\t\t\t\tthis._vrUI.triggerMouseDown();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'pointermove':\r\n\t\t\t\tthis._vrUI.setMouse(e.data);\r\n\t\t\t\tthis._vrUI.triggerMouseMove();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'pointerup':\r\n\t\t\t\t//this._onPointerUp();\r\n\t\t\t\tthis._vrUI.triggerMouseUp();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'pointerupoutside':\r\n\t\t\t\tthis._vrUI.reset(true);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t};\r\n\r\n\tget ui() {\r\n\t\treturn this._vrUI;\r\n\t}\r\n}\r\n","/*\r\n\r\nThis document explains the portion of the WebXR APIs for managing input across the range of XR hardware\r\nhttps://immersive-web.github.io/webxr/input-explainer\r\n\r\n*/\r\n\r\nimport * as THREE from 'three';\r\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js';\r\n\r\nimport { VRButton } from 'three/addons/webxr/VRButton.js';\r\nimport { ControllersManager, EventTypes as CMEventTypes } from '../xr/ControllersManager.js';\r\nimport { XRTeleportMoveControl } from '../xr/XRTeleportMoveControl.js';\r\nimport { UILVrMenu } from '../xr/UILVrMenu.js';\r\nimport * as UIL from '../vendor/uil.custom.module.js';\r\nimport { createVRMenuTestScene } from './sharedModules/vrMenuTestScene.js';\r\n\r\nlet renderer;\r\nlet scene;\r\nlet camera;\r\n\r\nlet clock = new THREE.Clock();\r\nlet floor;\r\n\r\nlet controllersManager;\r\nlet xrTeleportMoveControl;\r\n\r\nlet vrMenu;\r\n\r\nlet sceneElements;\r\n\r\nlet params = {\r\n\ttorusSpeed: 1,\r\n\tcubeSpeed: 1,\r\n\tlightHUE: 0.25,\r\n};\r\n\r\nwindow.params = params;\r\n\r\nfunction setupThreejs() {\r\n\t// Make a renderer that fills the screen\r\n\trenderer = new THREE.WebGLRenderer({ antialias: true });\r\n\trenderer.setPixelRatio(window.devicePixelRatio);\r\n\trenderer.setSize(window.innerWidth, window.innerHeight);\r\n\r\n\trenderer.xr.addEventListener('sessionstart', function (event) {});\r\n\r\n\trenderer.xr.addEventListener('sessionend', function (event) {});\r\n\trenderer.xr.enabled = true;\r\n\r\n\t// Add canvas to the page\r\n\tdocument.body.appendChild(renderer.domElement);\r\n\r\n\t// Add a button to enter/exit vr to the page\r\n\tdocument.body.appendChild(VRButton.createButton(renderer));\r\n\r\n\t// Make a new scene\r\n\tscene = new THREE.Scene();\r\n\r\n\t// Make a camera. note that far is set to 100, which is better for realworld sized environments\r\n\tcamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 10000);\r\n\tcamera.position.set(1, 3, 5);\r\n\r\n\tscene.add(camera);\r\n\r\n\tconst controls = new OrbitControls(camera, renderer.domElement);\r\n\tcontrols.target.set(0, 1, 0);\r\n\tcontrols.update();\r\n\r\n\t// Handle browser resize\r\n\twindow.addEventListener('resize', onWindowResize, false);\r\n}\r\n\r\nfunction setupXR() {\r\n\tcontrollersManager = new ControllersManager(renderer.xr, scene);\r\n\r\n\tcontrollersManager.addEventListener(CMEventTypes.ON_BUTTON_UP, (e) => {\r\n\t\tif (e.button == 'ButtonX') {\r\n\t\t\tvrMenu.toggleVisibility();\r\n\t\t\t// cancel the event propagation\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n\r\n\t//xrTeleportMoveControl = new XRTeleportMoveControl(renderer.xr, controllersManager, scene);\r\n\t//xrTeleportMoveControl.setTeleportSurfaces(floor.geometry);\r\n\tvrMenu = new UILVrMenu(scene, controllersManager, { mode: 'panel', debugLevel: 1 });\r\n}\r\n\r\nfunction onWindowResize() {\r\n\tcamera.aspect = window.innerWidth / window.innerHeight;\r\n\tcamera.updateProjectionMatrix();\r\n\trenderer.setSize(window.innerWidth, window.innerHeight);\r\n}\r\n\r\nfunction buildScene() {\r\n\tsceneElements = createVRMenuTestScene(scene);\r\n}\r\n\r\nfunction buildUI() {\r\n\tlet ui = vrMenu.ui;\r\n\r\n\tui.add(params, 'torusSpeed', { min: 0, max: 10 });\r\n\tui.add(params, 'cubeSpeed', { min: 0, max: 10 });\r\n\r\n\tlet g1 = ui.add('group', { name: 'Light', bg: '#442222' });\r\n\tg1.add(sceneElements.pointLight, 'intensity', { min: 0, max: 5 });\r\n\tg1.add(params, 'lightHUE', { name: ' light HUE', min: 0, max: 1 });\r\n\r\n\tg1.open();\r\n\tvrMenu.createMap();\r\n}\r\n\r\nfunction animate() {\r\n\trenderer.setAnimationLoop(render);\r\n}\r\n\r\nfunction render(time) {\r\n\tconst delta = clock.getDelta();\r\n\r\n\tcontrollersManager.update(time, delta);\r\n\t//xrTeleportMoveControl.update(delta);\r\n\r\n\trenderer.render(scene, camera);\r\n\r\n\tif (sceneElements) {\r\n\t\tsceneElements.torus.rotation.y += params.torusSpeed / 100;\r\n\t\tsceneElements.cube.rotation.y -= params.cubeSpeed / 100;\r\n\t\tsceneElements.pointLight.color.setHSL(params.lightHUE, 1, 0.5);\r\n\t}\r\n}\r\n\r\nsetupThreejs();\r\nbuildScene();\r\nsetupXR();\r\nbuildUI();\r\n\r\nanimate();\r\n"],"names":["UILVrMenu","VrMenu","worldContainer","controllersManager","options","__publicField","UIL.Gui","me","THREE.Texture","THREE.RepeatWrapping","THREE.LinearFilter","uiHeightPx","canvasHeightPx","canvasWidthPx","renderer","scene","camera","clock","THREE.Clock","vrMenu","sceneElements","params","setupThreejs","THREE.WebGLRenderer","event","VRButton","THREE.Scene","THREE.PerspectiveCamera","controls","OrbitControls","onWindowResize","setupXR","ControllersManager","CMEventTypes","e","buildScene","createVRMenuTestScene","buildUI","ui","g1","animate","render","time","delta"],"mappings":"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"}