var X=Object.defineProperty;var k=(e,t,n)=>t in e?X(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var u=(e,t,n)=>k(e,typeof t!="symbol"?t+"":t,n);import{f as F,B as U,e as S,W as $,V as K,S as q,P as J,O as Q,l as P,u as W,H as Z,C as A,v as ee,d as x,n as te,M as y,a as ne,b as R,F as oe,z as B,c as se}from"./VRButton.js";import{a as re,C as N,E as ae}from"./ControllersManager.js";import{X as ie}from"./XRTeleportMoveControl.js";import{c as le}from"./vrBasicTestScene.js";const ce={showHelpers:!0},E={ON_RAY_OVER:"onRayOver",ON_RAY_OUT:"onRayOut",ON_SELECTED:"onSelected"},C=[],_={left:null,right:null};class j extends re{constructor(n,o,c){super();u(this,"_options");u(this,"_controllersManager");u(this,"_targetObject");u(this,"_boundingBox");u(this,"_bboxHelper");u(this,"_scene");u(this,"_onRayStarted",n=>{n.handedness,n.ray;let o=this._controllersManager.getController(n.handedness);if(this.testRayBBoxIntersection(n.ray))return this.dispatchEvent({type:E.ON_SELECTED,controller:o,object:this._targetObject}),!1});if(this._scene=o,this._options=Object.assign({},ce,c),this._controllersManager=N.instance,this._targetObject=n,!(n instanceof F))throw new Error("SelectableVrObject: targetObject must be an instance of THREE.Object3D");this._controllersManager.addEventListener(ae.ON_RAY_STARTED,this._onRayStarted.bind(this)),C.push(this)}get targetObject(){return this._targetObject}testRayBBoxIntersection(n){this._targetObject.updateMatrixWorld(),this._boundingBox=new U().setFromObject(this._targetObject,!0);let o=n.intersectBox(this._boundingBox,new S);return o?o.distanceTo(n.origin):null}}u(j,"testRays",function(n){const o={left:{object:null,distance:1/0},right:{object:null,distance:1/0}};["left","right"].forEach(c=>{const w=_[c],l=o[c];let m=n.getController(c);m&&(C.forEach(g=>{let r=m.ray,a=g.testRayBBoxIntersection(r);a!=null&&a<l.distance&&(l.object=g,l.distance=a)}),w&&w!=l.object&&(w.dispatchEvent({type:E.ON_RAY_OUT,controller:m,hand:c,object:w.targetObject}),_[c]=null),l.object&&w!=l.object&&(l.object.dispatchEvent({type:E.ON_RAY_OVER,controller:m,hand:c,object:l.object.targetObject}),_[c]=l.object))})});let i,s,f,de=new se,v,T,G,d=[],h=[],M,V=0,z=0,p=null;const O=[];function ue(){i=new $({antialias:!0}),i.setPixelRatio(window.devicePixelRatio),i.setSize(window.innerWidth,window.innerHeight),i.xr.addEventListener("sessionstart",function(t){}),i.xr.addEventListener("sessionend",function(t){L()}),i.xr.enabled=!0,document.body.appendChild(i.domElement),document.body.appendChild(K.createButton(i)),s=new q,f=new J(50,window.innerWidth/window.innerHeight,.1,1e4),f.position.set(0,3,5),s.add(f);const e=new Q(f,i.domElement);e.target.set(0,1,0),e.update(),window.addEventListener("resize",L,!1)}function pe(){v=new N(i.xr,s),T=new ie(i.xr,v,s)}function L(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),i.setSize(window.innerWidth,window.innerHeight)}function he(){let e=new P(.5,.5,.5);d.push(e),e=new W(.4,32,32),d.push(e),e=new Z(.35,.05,48,32),d.push(e),e=new A(0,.5,.7),d.push(e),e=new ee(.2,.071,64,32),d.push(e);let t=new x({color:16711680,metalness:.5,roughness:.1});h.push(t),t=new x({color:255,metalness:.1,roughness:.5}),h.push(t),t=new x({color:65280,metalness:.5,roughness:.1,transparent:!0,opacity:.5}),h.push(t),t=new x({color:8421504,metalness:.5,roughness:.3}),h.push(t),t=new x({color:16776960,metalness:.5,roughness:.9}),h.push(t)}function we(){G=le(s);let e=new P(1,1,1),t=new te({color:16776960,wireframe:!0}),n=new y(e,t),o=n.clone();s.add(o),o.visible=!1,O.push(o),o=n.clone(),s.add(o),o.visible=!1,O.push(o),T.setTeleportSurfaces(G.floor.geometry),be()}function be(){const e=new ne(8,5),t=new R({color:"white",side:oe}),n=new y(e,t);n.position.set(0,2,-4),s.add(n);const o=new A(.5,.5,.2,32);o.translate(0,.1,0);const c=new R({color:13421772});M=new y(o,c),M.position.set(0,0,-2),s.add(M);const w=new R({color:10066329});let l=new B;for(let r=0;r<d.length;r++){let a=new y(d[r],w.clone());a.name="geometry"+r,a.userData.geometryIndex=r,a.position.set(r-(d.length-1)/2,0,0),l.add(a);let b=new j(a,s);b.addEventListener("onRayOver",D),b.addEventListener("onRayOut",I),b.addEventListener("onSelected",H)}l.position.set(0,2,-3),s.add(l);const m=new W(.4,32,32),g=new B;for(let r=0;r<h.length;r++){let a=new y(m,h[r]);a.name="material"+r,a.userData.materialIndex=r,a.position.set(r-(d.length-1)/2,0,0),g.add(a);let b=new j(a,s);b.addEventListener("onRayOver",D),b.addEventListener("onRayOut",I),b.addEventListener("onSelected",H)}g.position.set(0,3,-3),s.add(g)}function D(e){console.log("onRayOver",e),e.object.material.emissive.setHex(10066329)}function I(e){console.log("onRayOut",e),e.object.material.emissive.setHex(0)}function H(e){console.log("onSelected userData",e.object.userData);let t=e.object.userData;t.hasOwnProperty("geometryIndex")&&(z=t.geometryIndex,O[0].position.copy(e.object.localToWorld(new S(0,0,0))),O[0].visible=!0),t.hasOwnProperty("materialIndex")&&(V=t.materialIndex,O[1].position.copy(e.object.localToWorld(new S(0,0,0))),O[1].visible=!0),Y()}function Y(){p&&s.remove(p),p=new y(d[z],h[V].clone()),p.position.set(0,1,-2),p.scale.set(2,2,2),s.add(p)}function fe(){i.setAnimationLoop(me)}function me(e){const t=de.getDelta();v.update(e,t),T.update(t),j.testRays(v),i.render(s,f),p&&(p.rotation.y+=t),e+=t}ue();pe();he();we();Y();fe();
//# sourceMappingURL=selectableObjectsExample.js.map
